<% if (!token) { %>
    <!-- Forgot Password Form -->
    <form id="forgotPasswordForm" class="authForm">
        <input type="text" name="username" id="username" placeholder="Username" required>
        <button type="submit">Send Reset Link</button>
    </form>

    <script>
        document.getElementById("forgotPasswordForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const username = document.getElementById("username").value;

            try {
                const res = await fetch("/auth/api/forgot-password", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username })
                });

                const data = await res.json();
                if (!data.status) {
                    alert("Error: " + data.message);
                    return;
                }

                alert("Reset link sent to your email!");
                window.location.href = "/auth/login";
            } catch (err) {
                console.error("Error:", err);
                alert("Something went wrong. Please try again.");
            }
        });
    </script>

    <% } else { %>

        <!-- Reset Password Form -->
        <form id="resetPasswordForm" class="authForm">
            <input type="hidden" name="token" id="token" value="<%= token %>">
            <input type="password" name="password" id="password" placeholder="New Password" required>
            <button type="submit">Reset Password</button>
        </form>

        <script>
            window.history.replaceState({}, document.title, window.location.pathname);

            document.getElementById("resetPasswordForm").addEventListener("submit", async (e) => {
                e.preventDefault();

                const token = document.getElementById("token").value;
                const password = document.getElementById("password").value;

                try {
                    const res = await fetch("/auth/api/reset-password", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ token, password })
                    });

                    const data = await res.json();
                    if (!data.status) {
                        alert("Error: " + data.message);
                        return;
                    }

                    alert("Password reset successful!");
                    window.location.href = "/auth/login";
                } catch (err) {
                    console.error("Error:", err);
                    alert("Something went wrong. Please try again.");
                }
            });
        </script>

        <% } %>

            <!-- Display error message -->
            <% if (error) { %>
                <p>
                    <%= error %>
                </p>
                <% } %>